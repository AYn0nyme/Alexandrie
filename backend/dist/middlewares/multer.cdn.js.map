{"version":3,"file":"multer.cdn.js","sourceRoot":"","sources":["../../middlewares/multer.cdn.ts"],"names":[],"mappings":";;;AAAA,+BAA4B;AAC5B,4DAA4B;AAG5B,MAAM,SAAS,GAAG,EAAE,GAAG,IAAI,GAAG,IAAI,CAAC,CAAC,OAAO;AAE3C,IAAK,gBAOJ;AAPD,WAAK,gBAAgB;IACnB,qCAAmB,CAAA;IACnB,sCAAoB,CAAA;IACpB,qCAAmB,CAAA;IACnB,qCAAmB,CAAA;IACnB,uCAAqB,CAAA;IACrB,yCAAuB,CAAA;AACzB,CAAC,EAPI,gBAAgB,KAAhB,gBAAgB,QAOpB;AAED,MAAM,OAAO,GAAG,gBAAM,CAAC,WAAW,CAAC;IACjC,WAAW,EAAE,CAAC,CAAC,EAAE,EAAuB,EAAE,QAAkB,EAAE,EAAE;QAC9D,QAAQ,CAAC,IAAI,EAAE,GAAG,IAAA,WAAI,EAAC,SAAS,EAAE,sBAAsB,CAAC,EAAE,CAAC,CAAC;IAC/D,CAAC;IACD,QAAQ,EAAE,CAAC,CAAC,EAAE,IAAa,EAAE,QAAkB,EAAE,EAAE;QACjD,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAoD,CAAC;QAC3E,MAAM,SAAS,GAAG,gBAAgB,CAAC,QAAQ,CAAC,CAAC;QAC7C,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC,QAAQ,EAAE,GAAG,GAAG,GAAG,SAAS,CAAC;QACzD,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;IAC3B,CAAC;CACF,CAAC,CAAC;AAEH,kBAAe,IAAA,gBAAM,EAAC;IACpB,OAAO,EAAE,OAAO;IAChB,MAAM,EAAE;QACN,QAAQ,EAAE,SAAS;KACpB;IACD,UAAU,EAAE,CAAC,CAAC,EAAE,IAAa,EAAE,EAAY,EAAE,EAAE;QAC7C,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAoD,CAAC;QAC3E,IAAI,gBAAgB,CAAC,QAAQ,CAAC;YAAE,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;;YAC1C,EAAE,CAAC,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC;IACvC,CAAC;CACF,CAAC,CAAC,MAAM,CAAC;IACR;QACE,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,CAAC;KACZ;CACF,CAAC,CAAC","sourcesContent":["import { join } from 'path';\nimport multer from 'multer';\nimport type { IObject } from '../types';\n\nconst tailleMax = 20 * 1024 * 1024; // 20MB\n\nenum MIME_TYPES_IMAGE {\n  'image/jpg' = 'jpg',\n  'image/jpeg' = 'jpg',\n  'image/png' = 'png',\n  'image/gif' = 'gif',\n  'image/webp' = 'webp',\n  'image/svg+xml' = 'svg',\n}\n\nconst storage = multer.diskStorage({\n  destination: (_, __: Express.Multer.File, callback: Function) => {\n    callback(null, `${join(__dirname, `../../uploads/images`)}`);\n  },\n  filename: (_, file: IObject, callback: Function) => {\n    const mimetype = file.mimetype as unknown as keyof typeof MIME_TYPES_IMAGE;\n    const extension = MIME_TYPES_IMAGE[mimetype];\n    const fullName = Date.now().toString() + '.' + extension;\n    callback(null, fullName);\n  },\n});\n\nexport default multer({\n  storage: storage,\n  limits: {\n    fileSize: tailleMax,\n  },\n  fileFilter: (_, file: IObject, cb: Function) => {\n    const mimetype = file.mimetype as unknown as keyof typeof MIME_TYPES_IMAGE;\n    if (MIME_TYPES_IMAGE[mimetype]) cb(null, true);\n    else cb(new Error('[BAD_MIMETYPE]'));\n  },\n}).fields([\n  {\n    name: 'file',\n    maxCount: 1,\n  },\n]);\n"]}